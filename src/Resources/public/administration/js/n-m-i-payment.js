(function(){"use strict";var e={};e.p="bundles/nmipayment/",window?.__sw__?.assetPath&&(e.p=window.__sw__.assetPath+"/bundles/nmipayment/"),function(){let{Component:e,Mixin:t}=Shopware;e.register("nmi-api-test",{template:'<div>\n    <sw-button-process\n            :is-loading="isLoading"\n            :process-success="isSaveSuccessful"\n            @process-finish="saveFinish"\n            @click="check"\n    >\n        {{ $tc(\'NMI.apiTest.connection.test-api-connection\') }}\n    </sw-button-process>\n</div>',props:["label"],inject:["NmiApiTestService"],mixins:[t.getByName("notification")],data(){return{isLoading:!1,isSaveSuccessful:!1}},computed:{pluginConfig(){let e=this.$parent;for(;void 0===e.actualConfigData;)e=e.$parent;return e.actualConfigData.null}},methods:{saveFinish(){this.isSaveSuccessful=!1},getCurrentSalesChannelId(){let e=this.$parent;for(;void 0===e.currentSalesChannelId;)e=e.$parent;return e.currentSalesChannelId},check(){this.isLoading=!0;let e={...this.pluginConfig,salesChannelId:this.getCurrentSalesChannelId()};this.NmiApiTestService.check(e).then(e=>{if(e.success){this.isSaveSuccessful=!0;let t=this.$tc("NMI.apiTest.success.message");e.webhookUrl&&(t+=`

Webhook URL: ${e.webhookUrl}

Please register this URL in NMI merchant portal (Settings > Webhooks) and subscribe to all events.`),this.createNotificationSuccess({title:this.$tc("NMI.apiTest.success.title"),message:t})}else this.createNotificationError({title:this.$tc("NMI.apiTest.error.title"),message:this.$tc("NMI.apiTest.error.message")})}).catch(e=>{this.createNotificationError({title:"NMI API Test",message:e.response?.data?.errors?.[0]?.detail||e.message||"Connection failed!"})}).finally(()=>{this.isLoading=!1})}}});let s=Shopware.Classes.ApiService;class i extends s{constructor(e,t,s="nmi-test-connection"){super(e,t,s)}check(e){let t=this.getBasicHeaders();return this.httpClient.post(`_action/${this.getApiBasePath()}/test-connection`,e,{headers:t}).then(e=>s.handleResponse(e))}}Shopware.Service().register("NmiApiTestService",()=>new i(Shopware.Application.getContainer("init").httpClient,Shopware.Service("loginService")))}()})();