(()=>{"use strict";var e={857:e=>{var t=function(e){var t;return!!e&&"object"==typeof e&&"[object RegExp]"!==(t=Object.prototype.toString.call(e))&&"[object Date]"!==t&&e.$$typeof!==r},r="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function n(e,t){return!1!==t.clone&&t.isMergeableObject(e)?s(Array.isArray(e)?[]:{},e,t):e}function i(e,t,r){return e.concat(t).map(function(e){return n(e,r)})}function a(e){return Object.keys(e).concat(Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter(function(t){return Object.propertyIsEnumerable.call(e,t)}):[])}function o(e,t){try{return t in e}catch(e){return!1}}function s(e,r,l){(l=l||{}).arrayMerge=l.arrayMerge||i,l.isMergeableObject=l.isMergeableObject||t,l.cloneUnlessOtherwiseSpecified=n;var d,c,u=Array.isArray(r);return u!==Array.isArray(e)?n(r,l):u?l.arrayMerge(e,r,l):(c={},(d=l).isMergeableObject(e)&&a(e).forEach(function(t){c[t]=n(e[t],d)}),a(r).forEach(function(t){(!o(e,t)||Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))&&(o(e,t)&&d.isMergeableObject(r[t])?c[t]=(function(e,t){if(!t.customMerge)return s;var r=t.customMerge(e);return"function"==typeof r?r:s})(t,d)(e[t],r[t],d):c[t]=n(r[t],d))}),c)}s.all=function(e,t){if(!Array.isArray(e))throw Error("first argument should be an array");return e.reduce(function(e,r){return s(e,r,t)},{})},e.exports=s}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}(()=>{r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t}})(),(()=>{r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}})(),(()=>{r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{var e=r(857),t=r.n(e);class n{static ucFirst(e){return e.charAt(0).toUpperCase()+e.slice(1)}static lcFirst(e){return e.charAt(0).toLowerCase()+e.slice(1)}static toDashCase(e){return e.replace(/([A-Z])/g,"-$1").replace(/^-/,"").toLowerCase()}static toLowerCamelCase(e,t){let r=n.toUpperCamelCase(e,t);return n.lcFirst(r)}static toUpperCamelCase(e,t){return t?e.split(t).map(e=>n.ucFirst(e.toLowerCase())).join(""):n.ucFirst(e.toLowerCase())}static parsePrimitive(e){try{return/^\d+(.|,)\d+$/.test(e)&&(e=e.replace(",",".")),JSON.parse(e)}catch(t){return e.toString()}}}class i{static isNode(e){return"object"==typeof e&&null!==e&&(e===document||e===window||e instanceof Node)}static hasAttribute(e,t){if(!i.isNode(e))throw Error("The element must be a valid HTML Node!");return"function"==typeof e.hasAttribute&&e.hasAttribute(t)}static getAttribute(e,t){let r=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(r&&!1===i.hasAttribute(e,t))throw Error('The required property "'.concat(t,'" does not exist!'));if("function"!=typeof e.getAttribute){if(r)throw Error("This node doesn't support the getAttribute function!");return}return e.getAttribute(t)}static getDataAttribute(e,t){let r=!(arguments.length>2)||void 0===arguments[2]||arguments[2],a=t.replace(/^data(|-)/,""),o=n.toLowerCamelCase(a,"-");if(!i.isNode(e)){if(r)throw Error("The passed node is not a valid HTML Node!");return}if(void 0===e.dataset){if(r)throw Error("This node doesn't support the dataset attribute!");return}let s=e.dataset[o];if(void 0===s){if(r)throw Error('The required data attribute "'.concat(t,'" does not exist on ').concat(e,"!"));return s}return n.parsePrimitive(s)}static querySelector(e,t){let r=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(r&&!i.isNode(e))throw Error("The parent node is not a valid HTML Node!");let n=e.querySelector(t)||!1;if(r&&!1===n)throw Error('The required element "'.concat(t,'" does not exist in parent node!'));return n}static querySelectorAll(e,t){let r=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(r&&!i.isNode(e))throw Error("The parent node is not a valid HTML Node!");let n=e.querySelectorAll(t);if(0===n.length&&(n=!1),r&&!1===n)throw Error('At least one item of "'.concat(t,'" must exist in parent node!'));return n}static getFocusableElements(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body;return e.querySelectorAll('\n            input:not([tabindex^="-"]):not([disabled]):not([type="hidden"]),\n            select:not([tabindex^="-"]):not([disabled]),\n            textarea:not([tabindex^="-"]):not([disabled]),\n            button:not([tabindex^="-"]):not([disabled]),\n            a[href]:not([tabindex^="-"]):not([disabled]),\n            [tabindex]:not([tabindex^="-"]):not([disabled])\n        ')}static getFirstFocusableElement(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body;return this.getFocusableElements(e)[0]}static getLastFocusableElement(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,t=this.getFocusableElements(e);return t[t.length-1]}}class a{publish(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=new CustomEvent(e,{detail:t,cancelable:r});return this.el.dispatchEvent(n),n}subscribe(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=this,i=e.split("."),a=r.scope?t.bind(r.scope):t;if(r.once&&!0===r.once){let t=a;a=function(r){n.unsubscribe(e),t(r)}}return this.el.addEventListener(i[0],a),this.listeners.push({splitEventName:i,opts:r,cb:a}),!0}unsubscribe(e){let t=e.split(".");return this.listeners=this.listeners.reduce((e,r)=>([...r.splitEventName].sort().toString()===t.sort().toString()?this.el.removeEventListener(r.splitEventName[0],r.cb):e.push(r),e),[]),!0}reset(){return this.listeners.forEach(e=>{this.el.removeEventListener(e.splitEventName[0],e.cb)}),this.listeners=[],!0}get el(){return this._el}set el(e){this._el=e}get listeners(){return this._listeners}set listeners(e){this._listeners=e}constructor(e=document){this._el=e,e.$emitter=this,this._listeners=[]}}class o{init(){throw Error('The "init" method for the plugin "'.concat(this._pluginName,'" is not defined.'))}update(){}_init(){this._initialized||(this.init(),this._initialized=!0)}_update(){this._initialized&&this.update()}_mergeOptions(e){let r=n.toDashCase(this._pluginName),a=i.getDataAttribute(this.el,"data-".concat(r,"-config"),!1),o=i.getAttribute(this.el,"data-".concat(r,"-options"),!1),s=[this.constructor.options,this.options,e];a&&s.push(window.PluginConfigManager.get(this._pluginName,a));try{o&&s.push(JSON.parse(o))}catch(e){throw console.error(this.el),Error('The data attribute "data-'.concat(r,'-options" could not be parsed to json: ').concat(e.message))}return t().all(s.filter(e=>e instanceof Object&&!(e instanceof Array)).map(e=>e||{}))}_registerInstance(){window.PluginManager.getPluginInstancesFromElement(this.el).set(this._pluginName,this),window.PluginManager.getPlugin(this._pluginName,!1).get("instances").push(this)}_getPluginName(e){return e||(e=this.constructor.name),e}constructor(e,t={},r=!1){if(!i.isNode(e))throw Error("There is no valid element given.");this.el=e,this.$emitter=new a(this.el),this._pluginName=this._getPluginName(r),this.options=this._mergeOptions(t),this._initialized=!1,this._registerInstance(),this._init()}}class s{static loadCollectJS(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return console.log("Loading CollectJS..."),new Promise((i,a)=>{if("undefined"==typeof CollectJS){console.log("after start");let o=document.createElement("script");o.src=e,o.setAttribute("data-tokenization-key","jygC3z-8XkphM-JEBByn-6JTRdC"),document.head.appendChild(o),o.onload=()=>{console.log("CollectJS loaded and configured"),CollectJS.configure({paymentType:r,callback:t,...n}),i()},o.onerror=()=>{console.error("Failed to load CollectJS."),a()}}else console.warn("CollectJS is already loaded"),CollectJS.configure({paymentType:r,callback:t,...n}),i()})}}class l{static loadGatewayJS(e){console.log("Loading Gateway.js...");let t=document.createElement("script");t.src=e,document.head.appendChild(t),t.onload=()=>{console.log("Gateway.js loaded")},t.onerror=()=>{console.error("Failed to load Gateway.js.")}}static createGateway(e){return"undefined"==typeof Gateway?(console.error("Gateway SDK is not loaded"),null):Gateway.create(e)}}class d{static submitPayment(e,t){return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(async e=>{if(console.log("response in payment-service before if ok statement",e),!e.ok){console.log("here after the ok",e);let t=await e.json().catch(()=>null);throw Error((null==t?void 0:t.message)||"Payment submission failed with an unknown error")}return e.json()}).catch(e=>{throw console.error("Error during payment submission:",e),e})}static fetchCustomerData(e,t){return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(async e=>{if(!e.ok){let t=await e.json().catch(()=>null);throw Error((null==t?void 0:t.message)||"Failed to fetch customer data due to an unknown error")}return e.json()}).catch(e=>{throw console.error("Error fetching customer data:",e),e})}static addBillingToCustomerData(e,t){return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(async e=>{if(!e.ok){let t=await e.json().catch(()=>null);throw Error((null==t?void 0:t.message)||"Failed to add customer billing data ")}return e.json()}).catch(e=>{throw console.error("Error adding customer billing data:",e),e})}}class c extends o{init(){this._registerElements(),this._registerEvents(),this.isSavedCardBackend&&this.getVaultedCustomerData()}_registerElements(){this.parentCreditCardWrapper=document.getElementById(this.options.parentCreditCardWrapperId),this.vaultedId=this.parentCreditCardWrapper.getAttribute("data-vaulted-customer-id"),this.billingId=this.parentCreditCardWrapper.getAttribute("data-billing-customer-id"),this.isSavedCardBackend=this.parentCreditCardWrapper.getAttribute("data-saved-card"),this.currency=this.parentCreditCardWrapper.getAttribute("data-shop-currency"),this.amount=this.parentCreditCardWrapper.getAttribute("data-amount"),this.threeDSConfig=this.parentCreditCardWrapper.getAttribute("data-threeDSConfig"),this.dropdownCards=this.parentCreditCardWrapper.getAttribute("data-dropdown-cards"),this.deleteDataBtn=document.getElementById("delete-vaulted-customer-data"),this.addMoreCards=document.getElementById("add-another-vaulted-card"),this.loader=document.getElementById("nmiLoader"),this.configs=JSON.parse(this.parentCreditCardWrapper.getAttribute("data-configs")),this.cardSelect=document.getElementById("cardSelect"),this.cardHolderFirstName=document.getElementById("card-holder-first-name"),this.cardHolderLastName=document.getElementById("card-holder-last-name"),this.billingFirstName=this.parentCreditCardWrapper.getAttribute("data-billing-first-name"),this.billingLastName=this.parentCreditCardWrapper.getAttribute("data-billing-last-name"),this.billingCity=this.parentCreditCardWrapper.getAttribute("data-billing-city"),this.confirmOrderForm=document.forms[this.options.confirmFormId],this.cards=JSON.parse(this.dropdownCards)}_registerEvents(){this.confirmOrderForm.addEventListener("submit",this._onPayButtonClick.bind(this)),this.deleteDataBtn&&this.deleteDataBtn.addEventListener("click",this._onDeleteButtonClick.bind(this)),this.addMoreCards&&this.addMoreCards.addEventListener("click",this._onAddCardButtonClick.bind(this));let e=document.getElementById("pay-with-new-card");e&&e.addEventListener("click",this._onPayWithNewCard.bind(this)),document.getElementById("cardSelect").addEventListener("change",e=>{let t=e.target.value,r=this.cards.find(e=>e.billingId===t);r&&this.displayVaultedCustomerData({first_name:r.firstName,last_name:r.lastName,cc_number:r.lastDigits,cc_type:r.cardType})})}async _onPayButtonClick(e){e.preventDefault(),await s.loadCollectJS(this.options.collectJsUrl,this.submitPayment.bind(this),this.options.paymentType,{}),this.confirmOrderForm.checkValidity()&&(this.isSavedCardBackend?this.submitVaultedPayment():"undefined"!=typeof CollectJS&&CollectJS.startPaymentRequest())}async _onPayWithNewCard(e){e.preventDefault(),this._showLoading(!0);try{await s.loadCollectJS(this.options.collectJsUrl,this.submitPaymentWithNewC.bind(this),this.options.paymentType,{theme:"bootstrap",primaryColor:"#007bff",secondaryColor:"#6c757d",buttonText:"Pay Now"}),"undefined"!=typeof CollectJS?CollectJS.startPaymentRequest():console.error("CollectJS not loaded.")}catch(e){console.error("Error loading CollectJS:",e)}}_onDeleteButtonClick(e){e.preventDefault(),this._showLoading(!0),this.deleteVaultedCustomerData()}async _onAddCardButtonClick(e){e.preventDefault(),s.loadCollectJS(this.options.collectJsUrl,this.addBillingToCustomer.bind(this),this.options.paymentType,{theme:"bootstrap",primaryColor:"#ff288d",secondaryColor:"#3e79db",buttonText:"Add New Credit Card"}),this.confirmOrderForm.checkValidity()&&"undefined"!=typeof CollectJS&&CollectJS.startPaymentRequest()}_showLoading(e){let t=document.getElementById("nmiLoader");t&&(t.style.display=e?"inline-block":"none")}submitPayment(e){if(!e.token){console.error("Tokenization failed:",e.error),this.displayErrors(e.error);return}this.isSavedCardBackend?(this.submitVaultedPayment(e),this._showLoading(!1)):this.submitNormalPayment(e)}submitPaymentWithNewC(e){if(!e.token){console.error("Tokenization failed:",e.error),this.displayErrors(e.error);return}this.submitNormalPayment(e)}addBillingToCustomer(e){if(e.token)this.addCards(e);else{console.error("Tokenization failed:",e.error),this.displayErrors(e.error);return}}addCards(e){let t={token:e.token,ccnumber:e.card.number,ccexp:e.card.exp,card_type:e.card.type,vaulted_customer_id:this.vaultedId,first_name:this.billingFirstName,last_name:this.billingLastName};this.submitCard(this.options.paymentUrls.addCard,t)}deleteVaultedCustomerData(e){let t={customer_vault_id:this.vaultedId},r=this.options.paymentUrls.deleteVaultedCustomerData;d.fetchCustomerData(r,t).then(e=>{this._showLoading(!1),window.location.reload()}).catch(e=>{this.displayErrors(e),console.error("Error deleting vaulted customer data:",e),this._showLoading(!1)})}async getVaultedCustomerData(){let e={customer_vault_id:this.vaultedId},t=this.options.paymentUrls.getVaultedData;this._showLoading(!0),d.fetchCustomerData(t,e).then(e=>{this.fillDropdown(e),this.displayVaultedCustomerData(e)}).catch(e=>{console.error("Error fetching vaulted customer data:",e)}).finally(()=>{this._showLoading(!1)})}fillDropdown(e){let t=document.getElementById("cardSelect");if(t.innerHTML="",this.cards.length>0)this.cards.forEach(r=>{let n=document.createElement("option");n.value=r.billingId,n.textContent="".concat(r.firstName," ****").concat(r.lastDigits.slice(-4)),r.billingId===e.billingId&&(n.selected=!0),t.appendChild(n)});else{let e=document.createElement("option");e.value="",e.textContent="No saved cards available",t.appendChild(e)}}displayVaultedCustomerData(e){let{first_name:t,last_name:r,cc_number:n,cc_type:i}=e,a=n.slice(-4);document.getElementById("vaulted-first-name").innerText=t,document.getElementById("vaulted-last-name").innerText=r,document.getElementById("vaulted-last-four-digits").innerText="**** **** **** "+a,document.getElementById("vaulted-card-type").innerText=i}submitNormalPayment(e){let t,r;let n=this.threeDSConfig,i={token:e.token,amount:this.amount,first_name:document.querySelector('input[name="fname"]').value,last_name:document.querySelector('input[name="lname"]').value,address1:document.querySelector('input[name="address1"]').value,city:this.billingCity,zip:document.querySelector('input[name="zip"]').value,ccnumber:e.card.number,ccexp:e.card.exp,card_type:e.card.type,customer_vault:document.querySelector("#saveCardCheckbox")&&document.querySelector("#saveCardCheckbox").checked?"add_customer":null,saveCard:!!document.querySelector("#saveCardCheckbox")&&document.querySelector("#saveCardCheckbox").checked};if(n){let n=document.createElement("script");n.src=this.options.gatewayJsUrl,document.head.appendChild(n),n.onload=()=>{if(t=l.createGateway(this.configs.checkoutKey)){r=t.get3DSecure(),i.cavv=e.cavv,i.xid=e.xid,i.eci=e.eci,i.cardHolderAuth=e.cardHolderAuth,i.threeDsVersion=e.threeDsVersion,i.directoryServerId=e.directoryServerId,i.cardHolderInfo=e.cardHolderInfo;let n=r.createUI(i);n.start("body"),n.on("challenge",function(e){}),n.on("failure",function(e){console.error(e)}),t.on("error",function(e){console.error(e)}),this.submitToPaymentService(this.options.paymentUrls.creditCard,i)}},n.onerror=()=>{console.error("Failed to load Gateway.js.")}}else this.submitToPaymentService(this.options.paymentUrls.creditCard,i)}submitVaultedPayment(){var e;this._showLoading(!0);let t=document.getElementById("cardSelect"),r=document.getElementById("vaulted-first-name").innerText,n=document.getElementById("vaulted-last-name").innerText;t&&t.value;let i={amount:this.amount,customer_vault_id:this.vaultedId,first_name:r,last_name:n,billing_id:(e=t.value)!==null&&void 0!==e?e:null},a=this.options.paymentUrls.vaulted;this.submitToPaymentService(a,i,!0)}displayErrors(e){let t=document.getElementById("error-message"),r=t.querySelector(".error-alert");r.innerHTML="",e.length>0?(r.textContent=e.join(" "),t.classList.remove("d-none"),t.classList.add("d-block")):(t.classList.add("d-none"),t.classList.remove("d-block"))}submitToPaymentService(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];let r=document.getElementById("orderProcessingLoader1"),n=document.getElementById("orderProcessingLoader2"),i=document.querySelector(".nmiConfirmFormSubmit1"),a=document.querySelector(".nmiConfirmFormSubmit2");i&&r?r.style.display="flex":a&&n&&(n.style.display="flex"),d.submitPayment(e,t).then(e=>{if(e.success){let t=e.responses.payment.transaction_id,r=e.responses.payment.isSubscriptionCart,n=document.getElementById("cardSelect"),i=n?n.value:null;t&&(document.getElementById("nmi-transaction-id").value=null!=t?t:null,document.getElementById("nmi-is-subscription").value=null!=r?r:null,document.getElementById("nmi-selected-billing-id").value=null!=i?i:null),document.getElementById("confirmOrderForm").submit()}else{let t=e.errors||[e.message||"An unknown error occurred"];this.displayErrors(t),r&&(r.style.display="none"),n&&(n.style.display="none")}}).catch(e=>{console.error("Error submitting payment:",e),this.displayErrors([e.message||"Unexpected error occurred. Please try again later."]),r&&(r.style.display="none"),n&&(n.style.display="none")})}submitCard(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2],d.addBillingToCustomerData(e,t).then(e=>{if(e.success)window.location.reload();else{let t=e.errors||[e.message||"An unknown error occurred"];this.displayErrors(t)}}).catch(e=>{console.error("Error submitting payment:",e),this.displayErrors([e.message||"Unexpected error occurred. Please try again later."])})}}c.options={confirmFormId:"confirmOrderForm",formSelector:".lightbox-container",paymentUrls:{creditCard:"/nmi-payment-credit-card",vaulted:"/nmi-payment-vaulted-customer",getVaultedData:"/nmi-payment-get-vaulted-customer",deleteVaultedCustomerData:"/nmi-payment-delete-vaulted-customer",addCard:"/nmi-add-card"},collectJsUrl:"https://secure.nmi.com/token/Collect.js",gatewayJsUrl:"https://secure.nmi.com/js/v1/Gateway.js",paymentType:"cc",parentCreditCardWrapperId:"nmi-credit-card"},window.PluginManager.register("NmiCreditCardPlugin",c,"[nmi-payment-credit-card-plugin]")})()})();